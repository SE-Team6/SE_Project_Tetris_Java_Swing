package seoultech.se.tetris.menu;

import org.json.simple.JSONObject;

import javax.swing.*;
import javax.swing.border.LineBorder;
import java.awt.*;
import java.awt.event.*;
import java.util.Arrays;

import static seoultech.se.tetris.menu.SetDefault.screenWidth;
import static seoultech.se.tetris.component.JSONLoader.loaderKey;
import static seoultech.se.tetris.menu.SetDefault.key;
import static seoultech.se.tetris.menu.GetSetting.*;

public class SetKey1P extends JFrame{
    public static int labelWidth=200,labelHeight=40,labelFontSize=40;
    public static int textFieldWidth=120, textFieldHeight =40,textFieldFontSize=30;
    private int[] labelY = {120,170,220,270,320,370};// 0:left/1:right/2:up/3:down/4:esc/5:space

    private String [] textSequence = {"LEFT","RIGHT","UP","DOWN","ESC","SPACE"};
    private JLabel[] getLabel = new JLabel[6]; // 0:left/1:right/2:up/3:down/4:esc/5:space
    private JLabel[] setLabel =  new JLabel[6];
    private JButton saveButton = new JButton("SAVE");

    private LineBorder selectBorder = new LineBorder(Color.RED,3,true);
    private LineBorder noBorder = new LineBorder(Color.BLACK,3,true);

    SetDefault bs;
    BackMenuBtn bm = new BackMenuBtn();

    public static int positionPoint =0;
    char [] keyLoadCharValue = new char[6];
    String [] keyLoadStringValue = new String[6];
    JSONObject obj = loaderKey(1);
    Object [] var = new Object[6];

    public SetKey1P(){}

    public SetKey1P(int x, int y){
        bs = new SetDefault(x, y);
        bs.setVisible(true);
        keyLoad();
        setLocation();
        setLabel();
        getKeyLabel();
        bs.add(bm.backMenuBtn);
        bs.addKeyListener(new setKeyListener());
        backToMenuBtnAction();
        System.out.println(keyLoadCharValue[0]);
    }

    public class setKeyListener extends KeyAdapter {
        @Override
        public void keyPressed(KeyEvent e) {
            int keyVal= e.getKeyCode();
            if (keyVal==key.DOWN) {
                positionPoint +=1;
                if(positionPoint ==6) positionPoint =0;
                setBtnImage();
            }
            else if(keyVal == key.UP){
                positionPoint -=1;
                if(positionPoint == -1) positionPoint =5;
                setBtnImage();
            }
            else if(keyVal== KeyEvent.VK_ENTER){
                if(positionPoint<6) {
                    new GetKeyPanel(bs.getX(), bs.getY());
                    bs.setVisible(false);
                }
            }
            else if (keyVal==KeyEvent.VK_BACK_SPACE){
                bs.setVisible(false);
                new SetKeyMenu(bs.getX(), bs.getY());
            }
        }
    }
    public void setBtnImage(){
        for (int i=0;i<6;i++){
            if(positionPoint==i) getLabel[i].setBorder(selectBorder);
            else getLabel[i].setBorder(noBorder);
        }
        if(positionPoint==6) saveButton.setBackground(Color.RED);
        else saveButton.setBackground(Color.white);
    }
    public void setLabel(){ // 라벨 세팅
        for (int i=0;i<6;i++){
            setLabel[i]=new JLabel(textSequence[i]);
            setLabel[i].setFont(new Font("Sans Serif",Font.BOLD,labelFontSize));
            setLabel[i].setBounds(labelX,labelY[i],labelWidth,labelHeight);
            setLabel[i].setHorizontalAlignment(SwingConstants.CENTER);
            setLabel[i].setForeground(Color.YELLOW);
            bs.add(setLabel[i]);
        }
    }
    public void getKeyLabel(){
        for (int i=0;i<6;i++){
            getLabel[i]= new JLabel();
            getLabel[i].setBounds(textFieldX,labelY[i],textFieldWidth,textFieldHeight);
            getLabel[i].setFont(new Font("Sans Serif",Font.BOLD,textFieldFontSize));
            getLabel[i].setOpaque(true);
            getLabel[i].setBackground(Color.BLACK);
            getLabel[i].setForeground(Color.RED);
            getLabel[i].setHorizontalAlignment(SwingConstants.CENTER);
            int num= Integer.parseInt(var[i].toString());
            switch (num){
                case 37: // left
                    getLabel[i].setText("\u2190");
                    break;
                case 39: // Right
                    getLabel[i].setText("\u2192");
                    break;
                case 38: // Up
                    getLabel[i].setText("\u2191");
                    break;
                case 40: // Down
                    getLabel[i].setText("\u2193");
                    break;
                case 27: // Esc
                    getLabel[i].setText("\u238B");
                    break;
                case 32: // Space
                    getLabel[i].setText("\u2423");
                    break;
                default:
                    char value = (char)num;
                    keyLoadCharValue[i]=value;
                    getLabel[i].setText(String.valueOf(keyLoadCharValue[i]));
            }
            bs.add(getLabel[i]);
        }
        setBtnImage();
    }
    public void keyLoad(){// 기존 키 정보 불러오기?
        Arrays.fill(var,0);
        for (int i =0;i<6;i++){
            var[i]=obj.get(textSequence[i]);
        }
    }
    public void backToMenuBtnAction(){
        bm.backMenuBtn.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                bs.setVisible(false);
                new SetKeyMenu(bs.getX(), bs.getY());
            }
        });
    }
    public void setLocation(){// 해상도에 따른 버튼 라벨 텍스트필드 등 위치 설정 불러오기
        GetSetting ver =new GetSetting();
        switch (screenWidth){
            case 400:
                ver.keySetFirstSet();
                break;
            case 600:
                ver.keySetSecondSet();
                break;
            case 800:
                ver.keySetThirdSet();
                break;
        }
    }
}
